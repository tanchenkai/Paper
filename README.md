# Paper
1.输入设置qbits=1024, rbits=160，生成双线性配对的系统参数


2.KeyGen：车辆S生成Sk_s =x，对应的公钥是Pk_s 。服务器C生成sk_c =y,Pk_c =Y=yP 


3.通过对称加密算法rsa加密文件，并且保存密钥。同样的，可以通过密钥解密文件。


4.Trapdoor：输入私钥和关键字w，车辆\emph{S}计算对应的陷门$T_w  = (H_1(w)+x)^{-1}P$。


5.PEKS：输入车辆公钥$Pk_s$、服务器公钥$Pk_c$、关键字w，车辆\emph{S}随机选择$r_1,r_2 \in \mathbb{Z}{_q^*}$。车辆\emph{S}计算A = $r_1H_1(w)P+r_1X$, B = $r_2P$， V=$H_2(\hat{e}(r_1P+r_2A,Y))$。得到输出(A,B,V)。


6.将加密消息和PEKS结果连接可以得到加密文档。计算加密文档$Ct_s$的签名\cite{zhang2004efficient}。



7.Test：输入车辆公钥$Pk_s$、服务器私钥$Sk_c$、(A,B,V)、陷门$T_w$。然后测试$H_2(\hat{e}(yA\\,T_w+B)) =V$


8.为了能快速搜索签名$Sig$，服务器\emph{C}根据\emph{S}的区块链账户上次记录的序列号$Sn_{i-1}$，生成签名$Sig$的序列号$Sn_{i}$=1。服务器\emph{C}的区块链账户广播与发送者\emph{S}的交易$(Sig,Sn_i,data)$。$(Sig,Sn_i,data)$用于检查数据完整性和验证用户身份。生成的签名如图5-9所示长度为258位，因此将数据存入区块链消耗的以太坊费用（gas）太多。通过一次哈希算法（sha256），计算64位长度的签名如图5-11所示。

9.通过ganache可以快速启动本地的以太坊区块链，并且可以通过ganache查看交易区块和日志。

10.通过智能合约可以将数据写入区块链，在本文中通过在网页中输入如图5-11的签名，可以将签名写入区块链并且在网页中显示存入结果，交易区块如5-12所示。具体步骤为：（1）通过Remix编写智能合约，编译通过后在Remix网站上虚拟部署并测试。（2）在Remix网站上测试成功后，通过Chrome浏览器的插件Metamask新增ganache的RPC URL。（3）在ganache的 RPC URL 上添加ganache中生成的区块链账户私钥。（4）在该区块链账户中部署智能合约如图5-14所示。

11.在部署智能合约之后，通过JavaScript库JQuery、CSS/HTML框架Bootstrap、web3（以太坊的通用JSON-RPC规范JavaScript API）编写网页。在步骤10中部署区块链之后可以获取智能合约的地址，通过智能合于的地址以及web3命令web3.eth.Contract将网页与智能合约相连接如图5-15所示。

12. 通过web3.eth.getAccounts可以获取ganache生成的区块链账户。在输入栏输入图5-11的签名，将签名发送给获取到的区块链账户0上。

13.签名写入了区块链，并且在网页中得到了存入的区块链信息。
